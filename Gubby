btn.MouseButton1Click:Connect(function()
    if selectedCategory then
        selectedCategory.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    end
    selectedCategory = btn
    btn.BackgroundColor3 = Color3.fromRGB(80, 80, 80)

    if name == "Main Category" then
        print("Main Category clicked")
        if gagExtraGui then
            gagExtraGui.Enabled = false
            gagExtraGui:Destroy()
            gagExtraGui = nil
            print("Destroyed old gagExtraGui")
        end

        if isCorrectGame then
            print("Game ID matched, creating gagExtraGui")
            gagExtraGui = Instance.new("ScreenGui")
            gagExtraGui.Name = "GagFeaturesUI"
            gagExtraGui.Parent = playerGui
            gagExtraGui.Enabled = true

            local extraFrame = Instance.new("Frame")
            extraFrame.Size = UDim2.new(0, 400, 0, 300)
            extraFrame.Position = UDim2.new(0, 220 + 10, 0, 10)
            extraFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
            extraFrame.Parent = gagExtraGui
            roundify(extraFrame, 12)
            outline(extraFrame, Color3.fromRGB(255, 255, 255))

            local splatter = Instance.new("ImageLabel")
            splatter.Size = UDim2.new(1, 0, 1, 0)
            splatter.BackgroundTransparency = 1
            splatter.Image = "rbxassetid://1084635193"
            splatter.ImageColor3 = Color3.new(1, 1, 1)
            splatter.ImageTransparency = 0.85
            splatter.Parent = extraFrame

            local gagTitle = Instance.new("TextLabel")
            gagTitle.Size = UDim2.new(1, 0, 0, 40)
            gagTitle.BackgroundTransparency = 1
            gagTitle.Text = "GAG Features"
            gagTitle.TextColor3 = Color3.fromRGB(255, 255, 0)
            gagTitle.TextSize = 24
            gagTitle.Font = Enum.Font.GothamBold
            gagTitle.Parent = extraFrame

            -- create switches here (tp to gear shop + auto plant)
            local function createSwitch(parent, posY, labelText)
                local container = Instance.new("Frame")
                container.Size = UDim2.new(1, -20, 0, 40)
                container.Position = UDim2.new(0, 10, 0, posY)
                container.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
                container.Parent = parent
                roundify(container, 8)

                local label = Instance.new("TextLabel")
                label.Size = UDim2.new(0.7, 0, 1, 0)
                label.BackgroundTransparency = 1
                label.Text = labelText
                label.TextColor3 = Color3.fromRGB(255, 255, 255)
                label.TextSize = 18
                label.Font = Enum.Font.Gotham
                label.TextXAlignment = Enum.TextXAlignment.Left
                label.Parent = container

                local switchBtn = Instance.new("TextButton")
                switchBtn.Size = UDim2.new(0, 40, 0, 25)
                switchBtn.Position = UDim2.new(0.75, 0, 0.15, 0)
                switchBtn.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
                switchBtn.Text = ""
                switchBtn.Parent = container
                roundify(switchBtn, 12)

                local toggled = false
                local function updateToggle()
                    if toggled then
                        switchBtn.BackgroundColor3 = Color3.fromRGB(0, 200, 0)
                    else
                        switchBtn.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
                    end
                end

                switchBtn.MouseButton1Click:Connect(function()
                    toggled = not toggled
                    updateToggle()
                end)

                updateToggle()

                return container, switchBtn
            end

            createSwitch(extraFrame, 60, "tp to gear shop")

            -- auto plant switch
            local autoPlantContainer = Instance.new("Frame")
            autoPlantContainer.Size = UDim2.new(1, -20, 0, 40)
            autoPlantContainer.Position = UDim2.new(0, 10, 0, 110)
            autoPlantContainer.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
            autoPlantContainer.Parent = extraFrame
            roundify(autoPlantContainer, 8)

            local autoPlantLabel = Instance.new("TextLabel")
            autoPlantLabel.Size = UDim2.new(0.7, 0, 1, 0)
            autoPlantLabel.BackgroundTransparency = 1
            autoPlantLabel.Text = "auto plant"
            autoPlantLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
            autoPlantLabel.TextSize = 18
            autoPlantLabel.Font = Enum.Font.Gotham
            autoPlantLabel.TextXAlignment = Enum.TextXAlignment.Left
            autoPlantLabel.Parent = autoPlantContainer

            local autoPlantSwitch = Instance.new("TextButton")
            autoPlantSwitch.Size = UDim2.new(0, 40, 0, 25)
            autoPlantSwitch.Position = UDim2.new(0.75, 0, 0.15, 0)
            autoPlantSwitch.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
            autoPlantSwitch.Text = ""
            autoPlantSwitch.Parent = autoPlantContainer
            roundify(autoPlantSwitch, 12)

            local planting = false
            local elapsed = 0
            local interval = 0.3

            local function tryAutoPlant(dt)
                if not planting then return end
                elapsed = elapsed + dt
                if elapsed >= interval then
                    elapsed = 0
                    local character = player.Character
                    if character then
                        local tool = character:FindFirstChildOfClass("Tool")
                        if tool then
                            tool:Activate()
                        end
                    end
                end
            end

            RunService.RenderStepped:Connect(tryAutoPlant)

            local toggled = false
            local function updateToggle()
                if toggled then
                    autoPlantSwitch.BackgroundColor3 = Color3.fromRGB(0, 200, 0)
                    planting = true
                else
                    autoPlantSwitch.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
                    planting = false
                end
            end

            autoPlantSwitch.MouseButton1Click:Connect(function()
                toggled = not toggled
                updateToggle()
            end)

            updateToggle()
        else
            print("Game ID mismatch, gag features GUI not created")
            if gagExtraGui then
                gagExtraGui.Enabled = false
            end
        end
    else
        if gagExtraGui then gagExtraGui.Enabled = false end
    end
end)

